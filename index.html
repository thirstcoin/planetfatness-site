<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>$PHAT ‚Äî Planet Fatness</title>
  <meta name="description" content="$PHAT ‚Äî Planet Fatness Gym. Snack-first. Couch-certified. Play the games, stack calories, climb ranks, get rewarded." />
  <meta name="theme-color" content="#5b2cff" />
  <meta name="color-scheme" content="dark" />
  <meta property="og:title" content="$PHAT ‚Äî Planet Fatness" />
  <meta property="og:description" content="Snack-first. Couch-certified. The only gym where tapping counts as cardio. Play the games. Stack calories. Climb ranks. Get rewarded." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --bg0:#07050c;
      --bg1:#0b0716;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --purple:#5b2cff;
      --yellow:#ffd400;
      --yellow2:#ffe566;
      --shadow: 0 30px 90px rgba(0,0,0,.55);
      --shadow2: 0 18px 50px rgba(0,0,0,.45);
      --radius: 24px;
      --radius2: 18px;
      --max: 1120px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 650px at 20% 10%, rgba(91,44,255,.35), transparent 55%),
        radial-gradient(900px 560px at 85% 20%, rgba(255,212,0,.22), transparent 60%),
        radial-gradient(900px 560px at 55% 120%, rgba(255,212,0,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      color:var(--text);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ width:100%; display:flex; justify-content:center; }
    .container{ width:min(var(--max), calc(100% - 40px)); margin:0 auto; }

    body::before{
      content:""; position:fixed; inset:0; z-index:-3;
      background:
        radial-gradient(1200px 700px at 50% 8%, rgba(91,44,255,.42), transparent 60%),
        radial-gradient(980px 640px at 50% 96%, rgba(255,212,0,.20), transparent 62%),
        radial-gradient(760px 460px at 62% 44%, rgba(255,212,0,.08), transparent 62%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
    }
    .grain{
      pointer-events:none; position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      mix-blend-mode: overlay; opacity:.08; z-index:-1;
    }

    /* UI Components */
    .topbar{ position:sticky; top:0; z-index:20; backdrop-filter: blur(14px); background: linear-gradient(180deg, rgba(8,6,14,.80), rgba(8,6,14,.35)); border-bottom:1px solid rgba(255,255,255,.08); }
    .topbar .inner{ display:flex; align-items:center; justify-content:space-between; padding: 14px 0; gap:14px; }
    .brand{ display:flex; align-items:center; gap:12px; min-width: 240px; }
    .logoMark{ width:64px; height:64px; object-fit:contain; filter: drop-shadow(0 8px 16px rgba(0,0,0,.45)); }
    @media (max-width: 520px){ .logoMark{ width:48px; height:48px; } }

    .nav{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{ padding:10px 16px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05); color: rgba(255,255,255,.82); font-weight:800; font-size:13px; transition: 0.2s; cursor:pointer; }
    .chip:hover{ border-color: rgba(255,255,255,.25); background: rgba(255,255,255,.10); }
    .chip.active{ background: var(--yellow); color: #000; border-color: var(--yellow); }

    .cta{ padding:10px 14px; border-radius:999px; font-weight:1000; font-size:13px; color:#1a1400; background: linear-gradient(180deg, var(--yellow), #ffbf00); border:1px solid rgba(0,0,0,.18); box-shadow: 0 14px 30px rgba(255,212,0,.28); transition: 0.12s; cursor:pointer; }
    .cta:hover{ transform: translateY(-2px); filter: saturate(1.2); }

    .panel{ border-radius: var(--radius); background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04)); border: 1px solid rgba(255,255,255,.10); box-shadow: var(--shadow); overflow:hidden; position:relative; }
    .panel .pad{ position:relative; padding: 26px; z-index:2; }

    header.hero{ padding: 40px 0 14px; }
    .heroGrid{ display:grid; grid-template-columns: 1.12fr .88fr; gap: 18px; align-items:stretch; }
    @media (max-width: 940px){ .heroGrid{ grid-template-columns: 1fr; } }

    .kicker{ display:inline-flex; align-items:center; gap:10px; padding: 8px 12px; border-radius:999px; background: rgba(91,44,255,.22); border:1px solid rgba(255,255,255,.10); color: #fff; font-weight:900; font-size:11px; text-transform: uppercase; letter-spacing: 1px; }
    .dot{ width:8px; height:8px; border-radius:999px; background: var(--yellow); box-shadow: 0 0 0 6px rgba(255,212,0,.12); }

    .title{ margin: 14px 0 10px; font-size: clamp(38px, 5.6vw, 66px); line-height: 1.02; letter-spacing: -1.2px; font-weight: 1000; }
    .grad{ background: linear-gradient(90deg, var(--yellow), #fff 38%, var(--yellow)); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .subtitle{ margin:0 0 14px; font-size: clamp(15px, 2.5vw, 18px); color: rgba(255,255,255,.78); max-width: 72ch; line-height:1.50; }

    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:10px; padding: 14px 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.25); color: #fff; font-weight: 800; transition: 0.15s; cursor:pointer; }
    .btn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.3); }
    .btnPrimary{ color:#1a1400; background: linear-gradient(180deg, var(--yellow), #ffbf00); border-color: rgba(0,0,0,.1); }

    .statGrid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-top:10px; }
    .stat{ background: rgba(0,0,0,.2); padding:16px; border-radius:18px; border:1px solid var(--stroke); }
    .stat .k{ font-size:11px; text-transform:uppercase; color:var(--muted); font-weight:800; }
    .stat .v{ font-size:22px; font-weight:1000; margin:4px 0; color: var(--yellow2); }
    .stat .s{ font-size:10px; color:var(--muted); }

    table{ width:100%; border-collapse:collapse; text-align:left; }
    th{ padding:12px; font-size:11px; text-transform:uppercase; color:var(--muted); border-bottom:1px solid var(--stroke); }
    td{ padding:14px 12px; border-bottom:1px solid rgba(255,255,255,.04); font-size:14px; }
    .rank-cell{ width:50px; font-weight:1000; color:var(--muted); }
    .top3{ color:var(--yellow); }
    .streak-font{ font-weight:900; color: var(--yellow2); }

    .toast{ position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background: var(--purple); color:#fff; padding:12px 24px; border-radius:999px; z-index:1000; display:none; font-weight:800; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    
    section{ padding: 60px 0; }
    .sectionTitle{ margin-bottom: 30px; }
    .sectionTitle h2{ font-size:32px; font-weight:1000; margin:0; }
    .sectionTitle p{ color:var(--muted); margin:8px 0 0; }
  </style>
</head>

<body>
  <div class="grain"></div>
  <div class="toast" id="toast"></div>

  <div class="topbar">
    <div class="wrap">
      <div class="container inner">
        <div class="brand">
          <img class="logoMark" src="assets/thumbs-down.png" alt="Planet Fatness" />
          <div>
            <h3 style="margin:0; font-size:14px;">$PHAT ‚Äî Planet Fatness</h3>
            <p style="margin:0; font-size:11px; color:var(--muted);">snack-first ‚Ä¢ couch-certified</p>
          </div>
        </div>
        <div class="nav">
          <a class="chip" href="#gym">Gym</a>
          <a class="chip" href="#leaderboard">Ranks</a>
          <a class="chip" href="#manifesto">About</a>
          <button class="cta" id="playBtn">Play Now</button>
        </div>
      </div>
    </div>
  </div>

  <header class="hero">
    <div class="wrap">
      <div class="container heroGrid">
        <div class="panel">
          <div class="pad">
            <div class="kicker"><span class="dot"></span> treadmill-hostile culture</div>
            <h1 class="title">Planet <span class="grad">Fatness</span></h1>
            <p class="subtitle">
              The only gym where <b>tapping counts as cardio</b>. 
              Stack Calories (Grind) and Chase Streaks (Skill). 
              One miss ends the run‚Äîyour best streak is your legacy.
            </p>
            <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:20px;">
              <button class="btn btnPrimary" id="connectBtn">üü£ Connect Phantom</button>
              <a class="btn" href="#gym">Explore Games</a>
            </div>
          </div>
        </div>
        <aside class="panel" style="display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.2);">
          <div class="pad" style="text-align:center;">
             <img src="assets/phat-logo.png" style="width:100%; max-width:280px; border-radius:20px; box-shadow:var(--shadow2);" />
             <p style="font-size:12px; color:var(--muted); margin-top:15px;">Official Member Pass</p>
          </div>
        </aside>
      </div>
    </div>
  </header>

  <section id="gym">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>The Game Floor</h2>
          <p>Every calorie burned here is a calorie stacked for the leaderboard.</p>
        </div>

        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:20px;">
          <div class="panel">
            <div class="pad">
              <h3 style="margin:0;">üèÉ‚Äç‚ôÇÔ∏è Treadmill Rage</h3>
              <p style="font-size:13px; color:var(--muted);">Survival of the laziest. Don't fly off the belt.</p>
              <a class="btn btnPrimary" style="width:100%; margin-top:10px;" href="https://planetfatness.fit/runner/">Launch Runner</a>
            </div>
          </div>
          <div class="panel">
            <div class="pad">
              <h3 style="margin:0;">üèÄ Streak Shot</h3>
              <p style="font-size:13px; color:var(--muted);">One miss = Game Over. Your <b>Best Streak</b> is tracked.</p>
              <a class="btn btnPrimary" style="width:100%; margin-top:10px;" href="https://planetfatness.fit/basket/">Launch Arena</a>
            </div>
          </div>
          <div class="panel">
            <div class="pad">
              <h3 style="margin:0;">üçî Conveyor Munch</h3>
              <p style="font-size:13px; color:var(--muted);">Drag the snacks. Don't let a single burger pass.</p>
              <a class="btn btnPrimary" style="width:100%; margin-top:10px;" href="https://planetfatness.fit/snack/">Launch Munch</a>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:30px; border:1px solid var(--purple);">
          <div class="pad">
            <div class="sectionTitle" style="margin:0;">
              <h2 style="font-size:18px;">Your Membership Card</h2>
              <p id="authStatus" style="font-size:12px;">Waiting for connection...</p>
            </div>
            <div class="statGrid">
              <div class="stat">
                <div class="k">Member</div>
                <div class="v" id="meWallet">‚Äî</div>
              </div>
              <div class="stat">
                <div class="k">Lifetime Cals</div>
                <div class="v" id="meCalories">0</div>
              </div>
              <div class="stat">
                <div class="k">Best Streak</div>
                <div class="v" id="meBest">0</div>
              </div>
            </div>
            <div style="margin-top:20px; display:flex; gap:10px;">
              <button class="btn" id="refreshMeBtn" style="padding:10px 15px; font-size:12px;">Refresh Stats</button>
              <button class="btn" id="logoutBtn" style="padding:10px 15px; font-size:12px; color:#ff4444;">Logout</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="leaderboard">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>Gym Rankings</h2>
          <p>Skill is measured in Streaks. Dedication is measured in Calories.</p>
        </div>

        <div class="panel">
          <div class="pad">
            <div style="display:flex; gap:8px; margin-bottom:24px; overflow-x:auto; padding-bottom:4px;">
              <button class="chip active" data-win="lifetime" onclick="changeTab(this, 'lifetime')">Lifetime</button>
              <button class="chip" data-win="monthly" onclick="changeTab(this, 'monthly')">Monthly</button>
              <button class="chip" data-win="weekly" onclick="changeTab(this, 'weekly')">Weekly</button>
              <button class="chip" data-win="daily" onclick="changeTab(this, 'daily')">Daily</button>
            </div>

            <div style="overflow:auto;">
              <table>
                <thead>
                  <tr>
                    <th class="rank-cell">#</th>
                    <th>Member</th>
                    <th>Best Streak üèÄ</th>
                    <th>Total Calories üçî</th>
                  </tr>
                </thead>
                <tbody id="lbBody">
                  <tr><td colspan="4" class="muted" style="text-align:center; padding:40px;">Loading the elite...</td></tr>
                </tbody>
              </table>
            </div>
            
            <div style="margin-top:20px; text-align:right;">
              <button class="btn" id="refreshLbBtn" style="font-size:12px; padding:8px 16px;">Update Rankings</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="manifesto">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>The Manifesto</h2>
          <p>Respect the indulge. Honor the nap. Protect the vibe.</p>
        </div>
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:20px;">
          <div class="panel"><div class="pad"><h3>Snack-first</h3><p style="color:var(--muted); font-size:14px;">We don‚Äôt chase pain. We chase dopamine. That‚Äôs the whole program.</p></div></div>
          <div class="panel"><div class="pad"><h3>Consistency > Delusion</h3><p style="color:var(--muted); font-size:14px;">Starting Monday is tradition. Coming back tomorrow is the real flex.</p></div></div>
          <div class="panel"><div class="pad"><h3>Tapping is Cardio</h3><p style="color:var(--muted); font-size:14px;">Survive the treadmill. Time the curls. Munch the belt. Stack calories.</p></div></div>
        </div>
      </div>
    </div>
  </section>

  <footer style="padding:60px 0; border-top:1px solid var(--stroke); background:rgba(0,0,0,0.3);">
    <div class="wrap">
      <div class="container">
        <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:30px; margin-bottom:40px;">
          <div>
            <h3 style="margin:0;">$PHAT</h3>
            <p style="font-size:13px; color:var(--muted);">Planet Fatness Gym ‚Ä¢ ¬© <span id="yr"></span></p>
          </div>
          <div style="display:flex; gap:20px; font-weight:800; font-size:13px;">
            <a href="#gym">Gym</a>
            <a href="#leaderboard">Ranks</a>
            <a href="#manifesto">Manifesto</a>
            <a href="https://x.com/" target="_blank">Twitter</a>
          </div>
        </div>
        <div style="font-size:11px; color:var(--muted); line-height:1.6; max-width:800px;">
          <b>Gym Disclaimer:</b> $PHAT is a memecoin for entertainment purposes only. Nothing here is financial or fitness advice. 
          Playing games and climbing leaderboards involves no real-world health benefits, only glory.
        </div>
      </div>
    </div>
  </footer>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    const API_BASE = "https://planetfatness-backend.onrender.com";
    try { localStorage.setItem("pf_api_base", API_BASE); } catch {}

    const TOKEN_KEY = "pf_token", ADDR_KEY = "pf_address", TG_KEY = "pf_tg", ID_KIND = "pf_identity_kind";
    let currentLbWindow = 'lifetime';

    const toastEl = document.getElementById("toast");
    const authStatusEl = document.getElementById("authStatus");
    const meWalletEl = document.getElementById("meWallet"), meCaloriesEl = document.getElementById("meCalories"), meBestEl = document.getElementById("meBest");
    const lbBody = document.getElementById("lbBody");

    document.getElementById("yr").textContent = new Date().getFullYear();

    // Event Listeners
    document.getElementById("playBtn").addEventListener("click", () => window.location.href = "#gym");
    document.getElementById("connectBtn").addEventListener("click", connectAndLogin);
    document.getElementById("refreshMeBtn").addEventListener("click", loadMe);
    document.getElementById("refreshLbBtn").addEventListener("click", loadLeaderboard);
    document.getElementById("logoutBtn").addEventListener("click", logout);

    function toast(msg){
      toastEl.textContent = msg; toastEl.style.display = "block";
      clearTimeout(window.__t); window.__t = setTimeout(() => toastEl.style.display = "none", 2500);
    }

    function shortAddr(a){ return a ? a.slice(0, 4) + "‚Ä¶" + a.slice(-4) : "‚Äî"; }
    function getToken(){ return (localStorage.getItem(TOKEN_KEY) || "").trim(); }
    function getAddr(){ return (localStorage.getItem(ADDR_KEY) || "").trim(); }
    
    function setAuthUI(){
      const token = getToken();
      const addr = getAddr();
      const tg = JSON.parse(localStorage.getItem(TG_KEY) || "null");

      if (token){
        const display = tg ? (tg.username ? "@"+tg.username : tg.name) : shortAddr(addr);
        authStatusEl.textContent = "Gym Member Verified ‚úÖ";
        meWalletEl.textContent = display;
      } else {
        authStatusEl.textContent = "Not connected ‚Äî open in Telegram or use Phantom.";
        meWalletEl.textContent = "‚Äî"; meCaloriesEl.textContent = "0"; meBestEl.textContent = "0";
      }
    }

    // Leaderboard Tab Logic
    async function changeTab(btn, win){
      currentLbWindow = win;
      document.querySelectorAll('#leaderboard .chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      await loadLeaderboard();
    }

    async function loadLeaderboard(){
      try {
        const r = await fetch(`${API_BASE}/leaderboard/v2?window=${currentLbWindow}&limit=30`);
        const rows = await r.json();
        if(!Array.isArray(rows)) return;

        lbBody.innerHTML = rows.map((u, i) => {
          const name = u.display_name || u.username || shortAddr(u.address);
          const streak = u.best_streak || 0;
          const cals = u.total_calories || 0;
          return `
            <tr>
              <td class="rank-cell ${i<3?'top3':''}">#${i+1}</td>
              <td style="font-weight:700;">${escapeHtml(name)}</td>
              <td class="streak-font">${streak} üî•</td>
              <td style="font-family:monospace;">${Number(cals).toLocaleString()}</td>
            </tr>
          `;
        }).join("");
      } catch(e) { 
        lbBody.innerHTML = '<tr><td colspan="4" class="muted">Rankings offline.</td></tr>'; 
      }
    }

    async function loadMe(){
      const token = getToken();
      if(!token) return;
      try {
        const me = await fetch(API_BASE + "/activity/summary", {
          headers:{"Authorization":"Bearer " + token}
        }).then(r => r.json());
        meCaloriesEl.textContent = Number(me?.lifetime?.totalCalories || 0).toLocaleString();
        meBestEl.textContent = me?.lifetime?.bestStreak || me?.lifetime?.bestBasketStreak || 0;
      } catch(e) { console.error(e); }
    }

    // Auth Logic
    async function connectAndLogin(){
      const provider = window.solana;
      if (!provider?.isPhantom) {
        window.location.href = `https://phantom.app/ul/browse/${encodeURIComponent(window.location.href)}`;
        return;
      }
      try {
        const resp = await provider.connect();
        const address = resp.publicKey.toString();
        const ch = await fetch(API_BASE + "/auth/challenge", {
          method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({ address })
        }).then(r => r.json());

        const signed = await provider.signMessage(new TextEncoder().encode(ch.message), "utf8");
        const sigB64 = btoa(String.fromCharCode.apply(null, signed.signature));

        const v = await fetch(API_BASE + "/auth/verify", {
          method:"POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ address, nonce: ch.nonce, signature: sigB64 })
        }).then(r => r.json());

        if(v.token){
          localStorage.setItem(TOKEN_KEY, v.token);
          localStorage.setItem(ADDR_KEY, address);
          localStorage.setItem(ID_KIND, "wallet");
          setAuthUI(); loadMe(); loadLeaderboard();
          toast("Gym Card Locked ‚úÖ");
        }
      } catch(e) { toast("Connection failed."); }
    }

    async function telegramBootstrap(){
      const tg = window.Telegram?.WebApp;
      if(!tg || !tg.initData) return;
      tg.expand();
      try {
        const r = await fetch(API_BASE + "/auth/telegram", {
          method:"POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ initData: tg.initData })
        }).then(r => r.json());

        if(r.token){
          localStorage.setItem(TOKEN_KEY, r.token);
          localStorage.setItem(TG_KEY, JSON.stringify(tg.initDataUnsafe.user));
          localStorage.setItem(ID_KIND, "tg");
          localStorage.setItem(ADDR_KEY, `tg:${tg.initDataUnsafe.user.id}`);
          setAuthUI(); loadMe(); loadLeaderboard();
        }
      } catch(e) { console.error("TG Auth Fail", e); }
    }

    function logout(){ localStorage.clear(); location.reload(); }
    function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m])); }

    (async () => {
      setAuthUI();
      await loadLeaderboard();
      if(window.Telegram?.WebApp) telegramBootstrap();
      if(getToken()) loadMe();
    })();
  </script>
</body>
</html>
