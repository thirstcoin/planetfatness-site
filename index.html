<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>$PHAT ‚Äî Planet Fatness</title>
  <meta name="description" content="$PHAT ‚Äî Planet Fatness Gym. Snack-first. Couch-certified. Play the games, stack calories, climb ranks, get rewarded." />

  <meta name="theme-color" content="#5b2cff" />
  <meta name="color-scheme" content="dark" />

  <meta property="og:title" content="$PHAT ‚Äî Planet Fatness" />
  <meta property="og:description" content="Snack-first. Couch-certified. The only gym where tapping counts as cardio. Play the games. Stack calories. Climb ranks. Get rewarded." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --bg0:#07050c;
      --bg1:#0b0716;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);

      --purple:#5b2cff;
      --yellow:#ffd400;
      --yellow2:#ffe566;

      --shadow: 0 30px 90px rgba(0,0,0,.55);
      --shadow2: 0 18px 50px rgba(0,0,0,.45);

      --radius: 24px;
      --radius2: 18px;
      --max: 1120px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    html{ scroll-behavior:smooth; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 650px at 20% 10%, rgba(91,44,255,.35), transparent 55%),
        radial-gradient(900px 560px at 85% 20%, rgba(255,212,0,.22), transparent 60%),
        radial-gradient(900px 560px at 55% 120%, rgba(255,212,0,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      color:var(--text);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ width:100%; display:flex; justify-content:center; }
    .container{ width:min(var(--max), calc(100% - 40px)); margin:0 auto; }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-3;
      background:
        radial-gradient(1200px 700px at 50% 8%, rgba(91,44,255,.42), transparent 60%),
        radial-gradient(980px 640px at 50% 96%, rgba(255,212,0,.20), transparent 62%),
        radial-gradient(760px 460px at 62% 44%, rgba(255,212,0,.08), transparent 62%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
    }
    body::after{
      content:"";
      position:fixed;
      inset:0;
      z-index:-2;
      pointer-events:none;
      background:
        radial-gradient(1000px 520px at 50% 58%, rgba(91,44,255,.12), transparent 68%),
        radial-gradient(900px 420px at 50% 70%, rgba(255,212,0,.08), transparent 70%);
      opacity:.85;
      mix-blend-mode: screen;
    }

    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.08;
      z-index:-1;
    }

    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; transition:none !important; animation:none !important; }
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 100;
      display:none;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.55);
      color: rgba(255,255,255,.94);
      font-weight: 1000;
      font-size: 13px;
      backdrop-filter: blur(12px);
      box-shadow: 0 0 18px rgba(255,212,0,.18), 0 0 34px rgba(91,44,255,.14);
      max-width: min(720px, calc(100% - 30px));
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .topbar{
      position:sticky; top:0;
      z-index:20;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(8,6,14,.82), rgba(8,6,14,.36));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar .inner{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 0;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 240px;
    }
    .logoMark{
      width:54px; height:54px;
      display:block;
      flex:0 0 auto;
      background:transparent;
      object-fit:contain;
      filter: drop-shadow(0 16px 26px rgba(0,0,0,.45));
    }
    .brand h3{ margin:0; font-size:14px; letter-spacing:.3px; }
    .brand p{ margin:0; font-size:12px; color:var(--muted); font-weight:900; }

    .nav{
      display:flex; align-items:center; gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.82);
      font-weight:900;
      font-size:13px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .chip:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
    }

    .cta{
      padding:10px 14px;
      border-radius:999px;
      font-weight:1000;
      font-size:13px;
      color:#1a1400;
      background: linear-gradient(180deg, var(--yellow), #ffbf00);
      border:1px solid rgba(0,0,0,.18);
      box-shadow: 0 14px 30px rgba(255,212,0,.28);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      cursor:pointer;
      white-space:nowrap;
    }
    .cta:hover{ transform: translateY(-2px); box-shadow: 0 18px 46px rgba(255,212,0,.38); filter: saturate(1.08); }

    .panel{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 400px at 18% 0%, rgba(91,44,255,.35), transparent 55%),
        radial-gradient(800px 400px at 92% 30%, rgba(255,212,0,.20), transparent 60%);
      opacity:.92;
      pointer-events:none;
    }
    .panel .pad{ position:relative; padding: 26px; }

    .sectionTitle{ margin: 26px 0 12px; }
    .sectionTitle h2{
      margin:0;
      font-size: 20px;
      font-weight: 1000;
      letter-spacing: -.2px;
    }
    .sectionTitle p{
      margin: 6px 0 0;
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
      line-height: 1.35;
    }

    header.hero{ padding: 34px 0 14px; }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap: 18px;
      align-items:stretch;
    }
    @media (max-width: 940px){
      .heroGrid{ grid-template-columns: 1fr; }
      .brand{ min-width:auto; }
    }

    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 12px;
      border-radius:999px;
      background: rgba(91,44,255,.22);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.86);
      font-weight:1000;
      font-size:12px;
      letter-spacing:.4px;
      text-transform: uppercase;
    }
    .dot{ width:8px; height:8px; border-radius:999px; background: var(--yellow); box-shadow: 0 0 0 6px rgba(255,212,0,.12); }

    .title{
      margin: 14px 0 10px;
      font-size: clamp(38px, 5.6vw, 66px);
      line-height: 1.02;
      letter-spacing: -1.2px;
      font-weight: 1000;
    }
    .grad{
      background: linear-gradient(90deg, var(--yellow), #fff 38%, var(--yellow));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .subtitle{
      margin:0 0 14px;
      font-size: clamp(15px, 2.5vw, 18px);
      color: rgba(255,255,255,.78);
      max-width: 72ch;
      line-height:1.50;
      font-weight: 900;
    }
    .subtitle b{ color: rgba(255,255,255,.94); }

    .heroActions{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 16px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      font-weight: 1000;
      box-shadow: var(--shadow2);
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
      cursor:pointer;
      white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.06); }
    .btnPrimary{
      color:#1a1400;
      background: linear-gradient(180deg, var(--yellow), #ffbf00);
      border-color: rgba(0,0,0,.18);
      box-shadow: 0 18px 44px rgba(255,212,0,.22);
    }
    .btnPrimary:hover{ background: linear-gradient(180deg, #ffe566, var(--yellow)); }

    .miniRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; color: rgba(255,255,255,.70); font-size: 13px; }
    .miniRow span{ padding: 8px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.04); font-weight:1000; }

    .logoFrame{ display:flex; align-items:center; justify-content:center; padding: 14px; min-height: 360px; }
    .logoCard{
      width:100%;
      max-width: 520px;
      border-radius: 22px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 26px 80px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .logoCard::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 320px at 20% 10%, rgba(255,212,0,.18), transparent 60%),
        radial-gradient(520px 320px at 80% 20%, rgba(91,44,255,.26), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .logoCard .inner{ position:relative; padding: 16px; }
    .logoImg{
      width:100%; height:auto; display:block;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
    }
    .logoCaption{
      margin-top: 10px;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      color: rgba(255,255,255,.72);
      font-size: 12px;
      font-weight: 1000;
    }
    .tag{
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight: 1000;
    }

    .gameGrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-top: 12px;
    }
    @media (max-width: 860px){
      .gameGrid{ grid-template-columns: 1fr; }
    }
    .gameCard{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .gameCard::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 280px at 10% 0%, rgba(91,44,255,.22), transparent 60%),
        radial-gradient(520px 280px at 90% 10%, rgba(255,212,0,.12), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .gamePad{
      position:relative;
      padding: 18px;
      display:flex;
      gap: 14px;
      align-items:flex-start;
    }
    .gameIcon{
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(28px 28px at 30% 30%, rgba(255,212,0,.18), transparent 62%),
        radial-gradient(36px 36px at 80% 25%, rgba(91,44,255,.28), transparent 60%),
        rgba(255,255,255,.05);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .gameTitle{ margin:0; font-weight: 1100; font-size: 16px; letter-spacing: -.2px; }
    .gameDesc{ margin:6px 0 12px; color: rgba(255,255,255,.72); font-weight: 950; line-height:1.35; }
    .gameBtns{ display:flex; gap:10px; flex-wrap:wrap; }

    .statGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 960px){
      .statGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    .stat{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .stat::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(260px 160px at 20% 0%, rgba(91,44,255,.16), transparent 60%),
        radial-gradient(260px 160px at 80% 10%, rgba(255,212,0,.10), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .stat .k{ position:relative; font-weight: 1000; font-size: 12px; color: rgba(255,255,255,.72); }
    .stat .v{ position:relative; margin-top: 6px; font-weight: 1200; font-size: 22px; letter-spacing:-.3px; color: rgba(255,212,0,.95); }
    .stat .s{ position:relative; margin-top: 6px; font-weight: 950; font-size: 12px; color: rgba(255,255,255,.64); }

    .tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
    }
    .tab{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-weight: 1000;
      font-size: 12px;
      color: rgba(255,255,255,.84);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .tab.active{
      background: linear-gradient(180deg, rgba(255,212,0,.20), rgba(255,212,0,.10));
      border-color: rgba(255,212,0,.28);
      color: rgba(255,255,255,.96);
    }

    .tableWrap{
      margin-top: 12px;
      overflow:auto;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    table{
      width:100%;
      border-collapse: collapse;
      font-size: 13px;
      min-width: 740px;
    }
    th,td{
      padding: 10px 10px;
      text-align:left;
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-weight: 950;
      white-space: nowrap;
    }
    th{ color: rgba(255,255,255,.70); font-size: 11px; letter-spacing:.35px; text-transform: uppercase; }
    .rank{ width: 54px; }
    .muted{ color: var(--muted); }

    .lbGrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 940px){
      .lbGrid{ grid-template-columns: 1fr; }
      table{ min-width: 640px; }
    }
    .lbCard{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .lbCard::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 280px at 12% 0%, rgba(91,44,255,.16), transparent 60%),
        radial-gradient(520px 280px at 88% 10%, rgba(255,212,0,.08), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .lbCard .pad{ position:relative; padding: 16px; }
    .lbHead{
      display:flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .lbHead h3{
      margin:0;
      font-weight: 1100;
      font-size: 14px;
      letter-spacing: -.2px;
    }
    .pill{
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      font-size: 12px;
      font-weight: 1000;
      color: rgba(255,255,255,.76);
      white-space:nowrap;
    }

    footer{
      padding: 24px 0 40px;
      color: rgba(255,255,255,.72);
    }
    .footRow{
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      align-items:center;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.08);
      font-weight: 950;
      font-size: 12px;
    }
    .links{ display:flex; gap: 12px; flex-wrap:wrap; }
    .link{
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight:1000;
    }
    .disclaimer{
      margin-top: 12px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      font-weight: 900;
      line-height: 1.4;
      color: rgba(255,255,255,.72);
    }
  </style>
</head>

<body>
  <div class="grain"></div>
  <div class="toast" id="toast"></div>

  <div class="topbar">
    <div class="wrap">
      <div class="container inner">
        <div class="brand">
          <img class="logoMark" src="assets/thumbs-down.png" alt="Planet Fatness thumbs down" />
          <div>
            <h3>$PHAT ‚Äî Planet Fatness Gym</h3>
            <p>snack-first ‚Ä¢ couch-certified ‚Ä¢ rewards for grinders</p>
          </div>
        </div>

        <div class="nav">
          <a class="chip" href="#gym">Gym</a>
          <a class="chip" href="#leaderboard">Leaderboards</a>
          <a class="chip" href="#rewards">Rewards</a>
          <a class="chip" href="#manifesto">Manifesto</a>
          <button class="cta" id="playBtn">Play</button>
        </div>
      </div>
    </div>
  </div>
    <header class="hero">
    <div class="wrap">
      <div class="container heroGrid">
        <div class="panel">
          <div class="pad">
            <div class="kicker"><span class="dot"></span> snack-first ‚Ä¢ couch-certified ‚Ä¢ treadmill-hostile</div>

            <div class="title">Planet <span class="grad">Fatness</span></div>

            <p class="subtitle">
              This is for the real ones who don‚Äôt want to live in a gym.
              The ones who pick snacks over suffering, naps over neck veins,
              and ‚ÄúI‚Äôll start Monday‚Äù as a <b>lifestyle</b>.
              <br><br>
              The only gym where <b>tapping counts as cardio</b>.
              Play the Gym Games, stack <b>Calories</b>,
              climb the ranks, and get rewarded like a certified Planet Fatness member.
            </p>

            <div class="heroActions">
              <button class="btn btnPrimary" id="connectBtn">üü£ Connect Phantom</button>
              <a class="btn" href="https://planetfatness.fit/runner/">üèÉ‚Äç‚ôÇÔ∏è Rage Treadmill</a>
              <a class="btn" href="https://planetfatness.fit/lift/">üí™ Ego Lift Buffet</a>
              <a class="btn" href="https://planetfatness.fit/snack/">üçî Conveyor Munch</a>
              <a class="btn" href="https://planetfatness.fit/basket/">üèÄ Streak Shot</a>
            </div>

            <div class="miniRow">
              <span>üçï Snack-first philosophy</span>
              <span>üõãÔ∏è Couch cardio certified</span>
              <span>üèÉ‚Äç‚ôÇÔ∏è Best time flex</span>
              <span>üìà Daily / Weekly / Monthly / Lifetime</span>
              <span>üèÄ Streak Shot beasts</span>
              <span>üí∏ Rewards trackable</span>
            </div>
          </div>
        </div>

        <aside class="panel">
          <div class="pad logoFrame">
            <div class="logoCard">
              <div class="inner">
                <img class="logoImg" src="assets/phat-logo.png" alt="Planet Fatness logo" />
                <div class="logoCaption">
                  <span class="tag">$PHAT Logo</span>
                  <span class="muted">official mark ‚Ä¢ snack-first energy</span>
                </div>
              </div>
            </div>
          </div>
        </aside>

      </div>
    </div>
  </header>

  <section id="gym">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>Planet Fatness Gym</h2>
          <p>Pick your suffering (or snacks). Every game feeds the same calorie stack.</p>
        </div>

        <div class="gameGrid">
          <div class="gameCard">
            <div class="gamePad">
              <div class="gameIcon"></div>
              <div class="gameText">
                <h3 class="gameTitle">üèÉ‚Äç‚ôÇÔ∏è Treadmill Rage Runner</h3>
                <p class="gameDesc">Tap to survive. Stack calories. Fly off with honor. The belt is disrespectful.</p>
                <div class="gameBtns">
                  <a class="btn btnPrimary" href="https://planetfatness.fit/runner/">Play Runner</a>
                  <a class="btn" href="#leaderboard">See Winners</a>
                </div>
              </div>
            </div>
          </div>

          <div class="gameCard">
            <div class="gamePad">
              <div class="gameIcon"></div>
              <div class="gameText">
                <h3 class="gameTitle">üí™ Ego Lift Buffet</h3>
                <p class="gameDesc">Time the curl. Food plates count as weights. Respect the wobble or it claps you.</p>
                <div class="gameBtns">
                  <a class="btn btnPrimary" href="https://planetfatness.fit/lift/">Play Lift</a>
                  <a class="btn" href="#leaderboard">See Winners</a>
                </div>
              </div>
            </div>
          </div>

          <div class="gameCard">
            <div class="gamePad">
              <div class="gameIcon"></div>
              <div class="gameText">
                <h3 class="gameTitle">üçî Conveyor Munch</h3>
                <p class="gameDesc">Eat big to get big. Drag the snack into his mouth. Missed meals kill gains.</p>
                <div class="gameBtns">
                  <a class="btn btnPrimary" href="https://planetfatness.fit/snack/">Play Munch</a>
                  <a class="btn" href="#leaderboard">See Winners</a>
                </div>
              </div>
            </div>
          </div>

          <div class="gameCard">
            <div class="gamePad">
              <div class="gameIcon"></div>
              <div class="gameText">
                <h3 class="gameTitle">üèÄ Streak Shot</h3>
                <p class="gameDesc">One miss ends the run. Drag, aim, and feed the mouth. Golden donuts hit harder.</p>
                <div class="gameBtns">
                  <a class="btn btnPrimary" href="https://planetfatness.fit/basket/">Play Streak Shot</a>
                  <a class="btn" href="#leaderboard">See Winners</a>
                </div>
              </div>
            </div>
          </div>
        </div>
                <div style="margin-top:14px" class="panel">
          <div class="pad">
            <div class="sectionTitle" style="margin-top:0">
              <h2>Your Gym Card</h2>
              <p id="authStatus" class="muted">Not connected yet ‚Äî open in Telegram or connect Phantom to lock your member card.</p>
            </div>

            <div class="statGrid">
              <div class="stat">
                <div class="k">Member Identity</div>
                <div class="v" id="meIdentity">‚Äî</div>
                <div class="s">telegram-first ‚Ä¢ wallet optional</div>
              </div>
              <div class="stat">
                <div class="k">Lifetime Calories</div>
                <div class="v" id="meCaloriesLife">‚Äî</div>
                <div class="s">stacked across games</div>
              </div>
              <div class="stat">
                <div class="k">Runner Best Time</div>
                <div class="v" id="meRunnerBestTime">‚Äî</div>
                <div class="s">best single run</div>
              </div>
              <div class="stat">
                <div class="k">Lifetime Miles</div>
                <div class="v" id="meRunnerMiles">‚Äî</div>
                <div class="s">distance ran (lifetime)</div>
              </div>
            </div>

            <div class="sectionTitle" style="margin-top:16px">
              <h2>Calories Breakdown</h2>
              <p>Daily / Weekly / Monthly / Lifetime ‚Äî so rewards are easy to track.</p>
            </div>

            <div class="statGrid">
              <div class="stat">
                <div class="k">Daily</div>
                <div class="v" id="meCaloriesDaily">‚Äî</div>
                <div class="s">today‚Äôs burn</div>
              </div>
              <div class="stat">
                <div class="k">Weekly</div>
                <div class="v" id="meCaloriesWeekly">‚Äî</div>
                <div class="s">this week</div>
              </div>
              <div class="stat">
                <div class="k">Monthly</div>
                <div class="v" id="meCaloriesMonthly">‚Äî</div>
                <div class="s">this month</div>
              </div>
              <div class="stat">
                <div class="k">Lifetime</div>
                <div class="v" id="meCaloriesLifetime2">‚Äî</div>
                <div class="s">all-time stack</div>
              </div>
            </div>

            <div class="sectionTitle" style="margin-top:16px">
              <h2>Best Stats (Per Game)</h2>
              <p>Your best flexes ‚Äî one glance, no hunting.</p>
            </div>

            <div class="statGrid">
              <div class="stat">
                <div class="k">Runner</div>
                <div class="v" id="meRunnerBest">‚Äî</div>
                <div class="s" id="meRunnerBestSub">best time ‚Ä¢ best score</div>
              </div>
              <div class="stat">
                <div class="k">Lift</div>
                <div class="v" id="meLiftBest">‚Äî</div>
                <div class="s" id="meLiftBestSub">best set ‚Ä¢ best score</div>
              </div>
              <div class="stat">
                <div class="k">Munch</div>
                <div class="v" id="meSnackBest">‚Äî</div>
                <div class="s" id="meSnackBestSub">best combo</div>
              </div>
              <div class="stat">
                <div class="k">Streak Shot</div>
                <div class="v" id="meBasketBest">‚Äî</div>
                <div class="s" id="meBasketBestSub">best streak ‚Ä¢ best score</div>
              </div>
            </div>

            <div class="heroActions" style="margin-top:14px">
              <a class="btn btnPrimary" href="https://planetfatness.fit/runner/">üèÉ‚Äç‚ôÇÔ∏è Run it</a>
              <a class="btn" href="https://planetfatness.fit/lift/">üí™ Lift it</a>
              <a class="btn" href="https://planetfatness.fit/snack/">üçî Munch it</a>
              <a class="btn" href="https://planetfatness.fit/basket/">üèÄ Streak it</a>
              <button class="btn" id="refreshMeBtn">Refresh</button>
              <button class="btn" id="logoutBtn">Logout</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <section id="leaderboard">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>Leaderboards</h2>
          <p>Easy rewards tracking. One screen tells you who‚Äôs leading overall + who‚Äôs leading each game.</p>
        </div>

        <div class="panel">
          <div class="pad">
            <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:center;">
              <div class="muted">Switch the window: Daily / Weekly / Monthly / Lifetime.</div>
              <button class="btn" id="refreshLbBtn">Refresh</button>
            </div>

            <div class="tabs" id="lbTabs">
              <button class="tab active" data-window="daily">Daily</button>
              <button class="tab" data-window="weekly">Weekly</button>
              <button class="tab" data-window="monthly">Monthly</button>
              <button class="tab" data-window="lifetime">Lifetime</button>
            </div>

            <div class="sectionTitle" style="margin-top:16px">
              <h2>Overall Gym Winners</h2>
              <p>Top members by calories (this window).</p>
            </div>

            <div class="tableWrap">
              <table>
                <thead>
                  <tr>
                    <th class="rank">#</th>
                    <th>Identity</th>
                    <th>Calories</th>
                    <th>Runner Best</th>
                    <th>Lifetime Miles</th>
                  </tr>
                </thead>
                <tbody id="lbOverallBody">
                  <tr><td colspan="5" class="muted">Loading‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>

            <div class="sectionTitle" style="margin-top:18px">
              <h2>Game Leaders</h2>
              <p>Who‚Äôs #1 in each arena (this window).</p>
            </div>

            <div class="lbGrid">
              <div class="lbCard">
                <div class="pad">
                  <div class="lbHead">
                    <h3>üèÉ‚Äç‚ôÇÔ∏è Runner Leaders</h3>
                    <span class="pill">Calories + Best Time</span>
                  </div>
                  <div class="tableWrap">
                    <table>
                      <thead>
                        <tr>
                          <th class="rank">#</th>
                          <th>Identity</th>
                          <th>Calories</th>
                          <th>Best Time</th>
                        </tr>
                      </thead>
                      <tbody id="lbRunnerBody">
                        <tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="lbCard">
                <div class="pad">
                  <div class="lbHead">
                    <h3>üí™ Lift Leaders</h3>
                    <span class="pill">Calories + Best</span>
                  </div>
                  <div class="tableWrap">
                    <table>
                      <thead>
                        <tr>
                          <th class="rank">#</th>
                          <th>Identity</th>
                          <th>Calories</th>
                          <th>Best</th>
                        </tr>
                      </thead>
                      <tbody id="lbLiftBody">
                        <tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="lbCard">
                <div class="pad">
                  <div class="lbHead">
                    <h3>üçî Munch Leaders</h3>
                    <span class="pill">Calories + Best</span>
                  </div>
                  <div class="tableWrap">
                    <table>
                      <thead>
                        <tr>
                          <th class="rank">#</th>
                          <th>Identity</th>
                          <th>Calories</th>
                          <th>Best</th>
                        </tr>
                      </thead>
                      <tbody id="lbSnackBody">
                        <tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="lbCard">
                <div class="pad">
                  <div class="lbHead">
                    <h3>üèÄ Streak Shot Leaders</h3>
                    <span class="pill">Best Streak + Best Score</span>
                  </div>
                  <div class="tableWrap">
                    <table>
                      <thead>
                        <tr>
                          <th class="rank">#</th>
                          <th>Identity</th>
                          <th>Best Streak</th>
                          <th>Best Score</th>
                        </tr>
                      </thead>
                      <tbody id="lbBasketBody">
                        <tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
    </div>
  </section>
    <section id="rewards">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>Rewards</h2>
          <p>We don‚Äôt reward promises. We reward showing up‚Ä¶ and tapping like you mean it.</p>
        </div>

        <div class="panel">
          <div class="pad">
            <div class="sectionTitle" style="margin-top:0">
              <h2>How it goes down</h2>
              <p class="muted">You show up ‚Üí you tap ‚Üí you stack ‚Üí you get rewarded.</p>
            </div>

            <div class="statGrid">
              <div class="stat">
                <div class="k">1) Join</div>
                <div class="v">Telegram</div>
                <div class="s">you‚Äôre basically already logged in</div>
              </div>
              <div class="stat">
                <div class="k">2) Grind</div>
                <div class="v">4 Games</div>
                <div class="s">everything feeds the same calorie stack</div>
              </div>
              <div class="stat">
                <div class="k">3) Climb</div>
                <div class="v">Leaderboards</div>
                <div class="s">daily / weekly / monthly / lifetime</div>
              </div>
              <div class="stat">
                <div class="k">4) Eat</div>
                <div class="v">Rewards</div>
                <div class="s">top grinders get the love</div>
              </div>
            </div>

            <div style="margin-top:14px" class="muted">
              Rewards can be weekly or seasonal ‚Äî the windows make it obvious who earned it.
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <section id="manifesto">
    <div class="wrap">
      <div class="container">
        <div class="sectionTitle">
          <h2>Manifesto</h2>
          <p>Respect the indulge. Honor the nap. Protect the vibe.</p>
        </div>

        <div class="statGrid">
          <div class="stat">
            <div class="k">Snack-first</div>
            <div class="v">Dopamine</div>
            <div class="s">pain is optional around here</div>
          </div>
          <div class="stat">
            <div class="k">Consistency</div>
            <div class="v">Tomorrow</div>
            <div class="s">starting Monday is tradition</div>
          </div>
          <div class="stat">
            <div class="k">Cardio</div>
            <div class="v">Thumb</div>
            <div class="s">tapping counts as cardio</div>
          </div>
          <div class="stat">
            <div class="k">Culture</div>
            <div class="v">$PHAT</div>
            <div class="s">gym parody ‚Ä¢ community ‚Ä¢ games</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="wrap">
      <div class="container">
        <div class="footRow">
          <div>¬© <span id="yr"></span> Planet Fatness ‚Ä¢ $PHAT ‚Ä¢ snack-first</div>
          <div class="links">
            <a class="link" href="https://planetfatness.fit/runner/">Runner</a>
            <a class="link" href="https://planetfatness.fit/lift/">Lift</a>
            <a class="link" href="https://planetfatness.fit/snack/">Munch</a>
            <a class="link" href="https://planetfatness.fit/basket/">Streak Shot</a>
            <a class="link" href="#leaderboard">Leaderboards</a>
            <a class="link" href="#rewards">Rewards</a>
          </div>
        </div>

        <div class="disclaimer">
          <b>Gym Disclaimer:</b> $PHAT is a memecoin.
          Nothing on this site is financial advice, fitness advice, or life advice.
          <br><br>
          This is entertainment + culture + games. Calories are tracked. Leaderboards are real.
          Rewards (when live) are earned by participation.
          <br><br>
          Do your own research, manage your risk, and don‚Äôt fade a gym where tapping counts as cardio.
        </div>
      </div>
    </div>
  </footer>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
      const API_BASE = "https://planetfatness-backend.onrender.com";
    try { localStorage.setItem("pf_api_base", API_BASE); } catch {}

    const TOKEN_KEY = "pf_token";
    const ADDR_KEY  = "pf_address";
    const TG_KEY    = "pf_tg";
    const ID_KIND   = "pf_identity_kind";

    const toastEl = document.getElementById("toast");
    const authStatusEl = document.getElementById("authStatus");

    const meIdentityEl = document.getElementById("meIdentity");
    const meCaloriesLifeEl = document.getElementById("meCaloriesLife");
    const meRunnerBestTimeEl = document.getElementById("meRunnerBestTime");
    const meRunnerMilesEl = document.getElementById("meRunnerMiles");

    const meCaloriesDailyEl = document.getElementById("meCaloriesDaily");
    const meCaloriesWeeklyEl = document.getElementById("meCaloriesWeekly");
    const meCaloriesMonthlyEl = document.getElementById("meCaloriesMonthly");
    const meCaloriesLifetime2El = document.getElementById("meCaloriesLifetime2");

    const meRunnerBestEl = document.getElementById("meRunnerBest");
    const meRunnerBestSubEl = document.getElementById("meRunnerBestSub");
    const meLiftBestEl = document.getElementById("meLiftBest");
    const meLiftBestSubEl = document.getElementById("meLiftBestSub");
    const meSnackBestEl = document.getElementById("meSnackBest");
    const meSnackBestSubEl = document.getElementById("meSnackBestSub");
    const meBasketBestEl = document.getElementById("meBasketBest");
    const meBasketBestSubEl = document.getElementById("meBasketBestSub");

    const lbOverallBody = document.getElementById("lbOverallBody");
    const lbRunnerBody  = document.getElementById("lbRunnerBody");
    const lbLiftBody    = document.getElementById("lbLiftBody");
    const lbSnackBody   = document.getElementById("lbSnackBody");
    const lbBasketBody  = document.getElementById("lbBasketBody");

    document.getElementById("yr").textContent = new Date().getFullYear();

    document.getElementById("playBtn").addEventListener("click", () => {
      window.location.href = "https://planetfatness.fit/runner/";
    });

    document.getElementById("connectBtn").addEventListener("click", connectAndLogin);
    document.getElementById("refreshMeBtn").addEventListener("click", loadMe);
    document.getElementById("refreshLbBtn").addEventListener("click", () => loadAllLeaderboards(activeWindow));
    document.getElementById("logoutBtn").addEventListener("click", logout);

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(window.__toastT);
      window.__toastT = setTimeout(() => toastEl.style.display = "none", 2400);
    }

    function escapeHtml(s){
      return String(s || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function shortAddr(a){
      if (!a) return "‚Äî";
      return a.slice(0, 4) + "‚Ä¶" + a.slice(-4);
    }

    function fmtInt(n){
      const x = Number(n || 0);
      if (!isFinite(x)) return "‚Äî";
      return Math.round(x).toLocaleString();
    }

    function fmtMiles(n){
      const x = Number(n || 0);
      if (!isFinite(x)) return "‚Äî";
      if (x <= 0) return "0.00";
      return x.toFixed(2);
    }

    function fmtTime(seconds){
      const s = Math.max(0, Math.floor(Number(seconds) || 0));
      const m = Math.floor(s / 60);
      const r = s % 60;
      return m + ":" + String(r).padStart(2, "0");
    }

    function getToken(){ return (localStorage.getItem(TOKEN_KEY) || "").trim(); }
    function getAddr(){ return (localStorage.getItem(ADDR_KEY) || "").trim(); }
    function getTG(){
      try { return JSON.parse(localStorage.getItem(TG_KEY) || "null"); }
      catch { return null; }
    }

    function setSession(addr, token){
      localStorage.setItem(ADDR_KEY, addr);
      localStorage.setItem(TOKEN_KEY, token);
      localStorage.setItem(ID_KIND, "wallet");
    }

    function setTGSession(tg, token){
      try { localStorage.setItem(TG_KEY, JSON.stringify(tg)); } catch {}
      localStorage.setItem(TOKEN_KEY, token);
      localStorage.setItem(ID_KIND, "tg");
      if (tg?.id) localStorage.setItem(ADDR_KEY, `tg:${tg.id}`);
    }

    function clearSession(){
      localStorage.removeItem(ADDR_KEY);
      localStorage.removeItem(TOKEN_KEY);
      localStorage.removeItem(TG_KEY);
      localStorage.removeItem(ID_KIND);
    }

    function displayIdentity(){
      const kind = (localStorage.getItem(ID_KIND) || "").trim();
      const tg = getTG();
      const addr = getAddr();

      if (kind === "tg" && tg){
        return tg.username ? ("@" + tg.username) : (tg.name || ("TG:" + tg.id));
      }
      if (addr){
        if (addr.startsWith("tg:") && tg){
          return tg.username ? ("@" + tg.username) : (tg.name || ("TG:" + tg.id));
        }
        return shortAddr(addr);
      }
      if (tg){
        return tg.username ? ("@" + tg.username) : (tg.name || ("TG:" + tg.id));
      }
      return "‚Äî";
    }

    function setAuthUI(){
      const token = getToken();
      const ident = displayIdentity();

      if (token && ident !== "‚Äî"){
        authStatusEl.textContent = "Verified gym member: " + ident + " ‚úÖ";
        meIdentityEl.textContent = ident;
      } else {
        authStatusEl.textContent = "Not connected yet ‚Äî open in Telegram or connect Phantom to lock your member card.";
        meIdentityEl.textContent = "‚Äî";
      }
    }

    function readJSON(key){
      try { return JSON.parse(localStorage.getItem(key) || "null"); } catch { return null; }
    }
    function readBestRunner(){ return readJSON("pf_best_runner") || null; }
    function readBestLift(){ return readJSON("pf_best_lift") || null; }
    function readBestSnack(){ return readJSON("pf_best_snack") || null; }
    function readBestBasket(){ return readJSON("pf_best_basket") || null; }

    function waitForTelegram(ms = 3000){
      return new Promise((resolve) => {
        const start = Date.now();
        (function tick(){
          if (window.Telegram && window.Telegram.WebApp) return resolve(true);
          if (Date.now() - start > ms) return resolve(false);
          setTimeout(tick, 50);
        })();
      });
    }

    function isInTelegram(){
      return !!(window.Telegram && window.Telegram.WebApp);
    }

    function tgSafeUser(tgu){
      const id = tgu?.id;
      const username = (tgu?.username || "").trim();
      const name = [tgu?.first_name || "", tgu?.last_name || ""].join(" ").trim();
      return { id, username, name };
    }

    async function telegramBootstrapOnce(){
      const tg = isInTelegram() ? window.Telegram.WebApp : null;
      if (!tg) return false;

      try{
        tg.ready && tg.ready();
        tg.expand && tg.expand();

        const unsafeUser = tgSafeUser(tg.initDataUnsafe && tg.initDataUnsafe.user);
        const initData = (tg && typeof tg.initData === "string") ? tg.initData : "";

        if (!initData){
          if (unsafeUser && unsafeUser.id){
            try { localStorage.setItem(TG_KEY, JSON.stringify(unsafeUser)); } catch {}
            setAuthUI();
          }
          return false;
        }

        const existingKind = (localStorage.getItem(ID_KIND) || "").trim();
        const existingTg = getTG();
        const existingToken = getToken();
        const alreadySameTg =
          existingKind === "tg" &&
          existingToken &&
          existingTg &&
          unsafeUser?.id &&
          String(existingTg.id) === String(unsafeUser.id);

        if (alreadySameTg){
          setAuthUI();
          await loadMe();
          await loadAllLeaderboards(activeWindow);
          return true;
        }

        const r = await fetch(API_BASE + "/auth/telegram", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ initData })
        });

        const j = await r.json().catch(() => ({}));
        if (!r.ok || !j || !j.token){
          if (unsafeUser && unsafeUser.id){
            try { localStorage.setItem(TG_KEY, JSON.stringify(unsafeUser)); } catch {}
            setAuthUI();
          }
          return false;
        }

        const tgu = j.telegram || (tg.initDataUnsafe && tg.initDataUnsafe.user) || {};
        const tgUser = tgSafeUser(tgu);

        setTGSession(tgUser, j.token);
        setAuthUI();

        await loadMe();
        await loadAllLeaderboards(activeWindow);
        return true;

      } catch(e){
        return false;
      }
    }

    async function telegramBootstrapRetry(){
      if (!isInTelegram()) return;
      const delays = [0, 120, 200, 320, 500, 750, 900, 1200, 1500, 1800, 2200, 2600, 3200];
      for (let i = 0; i < delays.length; i++){
        if (delays[i]) await new Promise(r => setTimeout(r, delays[i]));
        const ok = await telegramBootstrapOnce();
        if (ok) break;
      }
    }

    function wireTelegramWakeups(){
      if (!isInTelegram()) return;
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) telegramBootstrapRetry();
      });
      window.addEventListener("focus", () => telegramBootstrapRetry());
      try{
        const tg = window.Telegram.WebApp;
        if (tg && tg.onEvent){
          tg.onEvent("viewportChanged", () => telegramBootstrapRetry());
        }
      }catch{}
    }

    async function connectAndLogin(){
      const provider = window.solana;
      if (provider?.isPhantom) return await connectInjected(provider);
      toast("Opening Phantom‚Ä¶");
      openInPhantomBrowser(window.location.href);
    }

    async function connectInjected(provider){
      try{
        const resp = await provider.connect();
        const address = resp.publicKey.toString();

        toast("Connected " + shortAddr(address) + " ‚úÖ");

        const ch = await fetch(API_BASE + "/auth/challenge", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ address })
        }).then(r => r.json());

        if (ch.error) { toast("Couldn‚Äôt start login."); return; }

        const msgBytes = new TextEncoder().encode(ch.message);
        const signed = await provider.signMessage(msgBytes, "utf8");
        const sigB64 = bytesToBase64(signed.signature);

        const v = await fetch(API_BASE + "/auth/verify", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ address, nonce: ch.nonce, signature: sigB64 })
        }).then(r => r.json());

        if (!v.token){ toast("Login didn‚Äôt lock in."); return; }

        setSession(address, v.token);
        toast("Gym card locked ‚úÖ");
        setAuthUI();
        await loadMe();
        await loadAllLeaderboards(activeWindow);

      }catch(e){
        toast("Connect cancelled.");
      }
    }

    function openInPhantomBrowser(url){
      const target = encodeURIComponent(url);
      window.location.href = `https://phantom.app/ul/browse/${target}`;
    }

    function bytesToBase64(bytes){
      let bin = "";
      const arr = new Uint8Array(bytes);
      for (let i = 0; i < arr.length; i++) bin += String.fromCharCode(arr[i]);
      return btoa(bin);
    }

    async function loadMe(){
      setAuthUI();

      meCaloriesLifeEl.textContent = "‚Äî";
      meRunnerBestTimeEl.textContent = "‚Äî";
      meRunnerMilesEl.textContent = "‚Äî";
      meCaloriesDailyEl.textContent = "‚Äî";
      meCaloriesWeeklyEl.textContent = "‚Äî";
      meCaloriesMonthlyEl.textContent = "‚Äî";
      meCaloriesLifetime2El.textContent = "‚Äî";

      hydrateLocalBestStats();

      const token = getToken();
      if (!token) return;

      try{
        const me = await fetch(API_BASE + "/activity/summary", {
          headers:{ "Authorization":"Bearer " + token }
        }).then(r => r.json());

        if (me?.error) return;

        meIdentityEl.textContent = displayIdentity();

        const daily   = Number(me?.daily?.calories ?? me?.day?.calories ?? 0) || 0;
        const weekly  = Number(me?.weekly?.calories ?? me?.week?.calories ?? 0) || 0;
        const monthly = Number(me?.monthly?.calories ?? me?.month?.calories ?? 0) || 0;
        const life    = Number(me?.lifetime?.totalCalories ?? me?.lifetime?.calories ?? me?.lifetimeCalories ?? 0) || 0;

        meCaloriesDailyEl.textContent = fmtInt(daily);
        meCaloriesWeeklyEl.textContent = fmtInt(weekly);
        meCaloriesMonthlyEl.textContent = fmtInt(monthly);
        meCaloriesLifeEl.textContent = fmtInt(life);
        meCaloriesLifetime2El.textContent = fmtInt(life);

        const bestSecs =
          Number(me?.lifetime?.bestSeconds ?? me?.runner?.bestSeconds ?? me?.bestSeconds ?? 0) || 0;

        const miles =
          Number(me?.lifetime?.totalMiles ?? me?.runner?.totalMiles ?? 0) ||
          (Number(me?.lifetime?.totalDistanceMeters ?? me?.runner?.totalDistanceMeters ?? 0) / 1609.344) ||
          0;

        if (bestSecs > 0) meRunnerBestTimeEl.textContent = fmtTime(bestSecs);
        if (miles >= 0) meRunnerMilesEl.textContent = fmtMiles(miles);

      } catch(e){
      }
    }

    function hydrateLocalBestStats(){
      const r = readBestRunner();
      if (r){
        const bestTime = r.bestSeconds ? fmtTime(r.bestSeconds) : null;
        const bestScore = r.bestScore != null ? fmtInt(r.bestScore) : null;
        meRunnerBestEl.textContent = bestTime ? bestTime : (bestScore ? bestScore : "‚Äî");
        meRunnerBestSubEl.textContent =
          (bestTime ? `best time: ${bestTime}` : "best time: ‚Äî") +
          (bestScore ? ` ‚Ä¢ best score: ${bestScore}` : "");

        if (r.miles != null && Number(r.miles) >= 0){
          meRunnerMilesEl.textContent = fmtMiles(r.miles);
        }
        if (r.bestSeconds != null && Number(r.bestSeconds) > 0){
          meRunnerBestTimeEl.textContent = fmtTime(r.bestSeconds);
        }
      } else {
        meRunnerBestEl.textContent = "‚Äî";
        meRunnerBestSubEl.textContent = "best time ‚Ä¢ best score";
      }

      const l = readBestLift();
      if (l){
        const a = (l.bestReps != null) ? `${fmtInt(l.bestReps)} reps` : null;
        const b = (l.bestScore != null) ? `${fmtInt(l.bestScore)} score` : null;
        meLiftBestEl.textContent = a || b || "‚Äî";
        meLiftBestSubEl.textContent = [a ? `best: ${a}` : "best: ‚Äî", b ? b : ""].filter(Boolean).join(" ‚Ä¢ ");
      } else {
        meLiftBestEl.textContent = "‚Äî";
        meLiftBestSubEl.textContent = "best set ‚Ä¢ best score";
      }

      const s = readBestSnack();
      if (s){
        const best = (s.bestScore != null) ? fmtInt(s.bestScore) : null;
        meSnackBestEl.textContent = best || "‚Äî";
        meSnackBestSubEl.textContent = best ? `best score: ${best}` : "best combo";
      } else {
        meSnackBestEl.textContent = "‚Äî";
        meSnackBestSubEl.textContent = "best combo";
      }

      const b = readBestBasket();
      if (b){
        const st = (b.bestStreak != null) ? fmtInt(b.bestStreak) : null;
        const sc = (b.bestScore != null) ? fmtInt(b.bestScore) : null;
        meBasketBestEl.textContent = st ? st : (sc ? sc : "‚Äî");
        meBasketBestSubEl.textContent =
          (st ? `best streak: ${st}` : "best streak: ‚Äî") +
          (sc ? ` ‚Ä¢ best score: ${sc}` : "");
      } else {
        meBasketBestEl.textContent = "‚Äî";
        meBasketBestSubEl.textContent = "best streak ‚Ä¢ best score";
      }
    }

    const GAME = { runner:"runner", lift:"lift", snack:"snack", basket:"basket" };
    let activeWindow = "daily";

    function fmtIdent(row){
      const dn = (row.display_name || row.displayName || row.name || "").trim();
      const addr = String(row.address || "").trim();
      if (dn) return dn;
      if (addr.startsWith("tg:")) return "@" + addr.slice(3);
      if (addr) return addr.slice(0,4) + "‚Ä¶" + addr.slice(-4);
      return "‚Äî";
    }

    function getRowNumber(row, keys){
      for (const k of keys){
        if (row && row[k] != null) return Number(row[k]) || 0;
      }
      return 0;
    }

    async function fetchV2({ window, metric, game, limit }){
      const qs = new URLSearchParams();
      if (window) qs.set("window", window);
      if (metric) qs.set("metric", metric);
      if (game) qs.set("game", game);
      if (limit) qs.set("limit", String(limit || 30));
      const url = API_BASE + "/leaderboard/v2?" + qs.toString();

      const r = await fetch(url, { headers:{ "Accept":"application/json" } });
      if (!r.ok) return null;
      const j = await r.json().catch(()=>null);
      if (Array.isArray(j)) return j;
      if (j && Array.isArray(j.rows)) return j.rows;
      return null;
    }

    async function loadAllLeaderboards(windowKey){
      activeWindow = windowKey || activeWindow;

      lbOverallBody.innerHTML = `<tr><td colspan="5" class="muted">Loading‚Ä¶</td></tr>`;
      lbRunnerBody.innerHTML  = `<tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>`;
      lbLiftBody.innerHTML    = `<tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>`;
      lbSnackBody.innerHTML   = `<tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>`;
      lbBasketBody.innerHTML  = `<tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>`;

      const overall = await fetchV2({ window: activeWindow, metric:"calories", limit: 30 });

      if (!overall || !overall.length){
        lbOverallBody.innerHTML = `<tr><td colspan="5" class="muted">No entries yet. First gym rat gets bragging rights.</td></tr>`;
      } else {
        lbOverallBody.innerHTML = overall.slice(0,30).map((u,i)=>{
          const ident = escapeHtml(fmtIdent(u));
          const cals  = getRowNumber(u, ["value","calories","total_calories","totalCalories"]);
          const best  = getRowNumber(u, ["best_seconds","bestSeconds","bestSecondsRunner"]);
          const miles = getRowNumber(u, ["total_miles","totalMiles","miles","lifetimeMiles"]);
          return `
            <tr>
              <td class="rank">${i+1}</td>
              <td>${ident}</td>
              <td>${fmtInt(cals)}</td>
              <td>${best ? fmtTime(best) : "‚Äî"}</td>
              <td>${isFinite(miles) && miles >= 0 ? fmtMiles(miles) : "‚Äî"}</td>
            </tr>
          `;
        }).join("");
      }

      const [runner, lift, snack] = await Promise.all([
        fetchV2({ window: activeWindow, metric:"calories", game: GAME.runner, limit: 20 }),
        fetchV2({ window: activeWindow, metric:"calories", game: GAME.lift, limit: 20 }),
        fetchV2({ window: activeWindow, metric:"calories", game: GAME.snack, limit: 20 }),
      ]);

      const basketStreak = await fetchV2({ window: activeWindow, metric:"streak", game: GAME.basket, limit: 20 });
      const basketScore  = await fetchV2({ window: activeWindow, metric:"score",  game: GAME.basket, limit: 20 });

      if (!runner || !runner.length){
        lbRunnerBody.innerHTML = `<tr><td colspan="4" class="muted">No runner entries yet.</td></tr>`;
      } else {
        lbRunnerBody.innerHTML = runner.slice(0,10).map((u,i)=>{
          const ident = escapeHtml(fmtIdent(u));
          const cals  = getRowNumber(u, ["value","calories","total_calories","totalCalories"]);
          const best  = getRowNumber(u, ["best_seconds","bestSeconds","bestSecondsRunner"]);
          return `
            <tr>
              <td class="rank">${i+1}</td>
              <td>${ident}</td>
              <td>${fmtInt(cals)}</td>
              <td>${best ? fmtTime(best) : "‚Äî"}</td>
            </tr>
          `;
        }).join("");
      }

      if (!lift || !lift.length){
        lbLiftBody.innerHTML = `<tr><td colspan="4" class="muted">No lift entries yet.</td></tr>`;
      } else {
        lbLiftBody.innerHTML = lift.slice(0,10).map((u,i)=>{
          const ident = escapeHtml(fmtIdent(u));
          const cals  = getRowNumber(u, ["value","calories","total_calories","totalCalories"]);
          const best  = getRowNumber(u, ["best","best_score","bestScore","score","value"]);
          return `
            <tr>
              <td class="rank">${i+1}</td>
              <td>${ident}</td>
              <td>${fmtInt(cals)}</td>
              <td>${best ? fmtInt(best) : "‚Äî"}</td>
            </tr>
          `;
        }).join("");
      }

      if (!snack || !snack.length){
        lbSnackBody.innerHTML = `<tr><td colspan="4" class="muted">No munch entries yet.</td></tr>`;
      } else {
        lbSnackBody.innerHTML = snack.slice(0,10).map((u,i)=>{
          const ident = escapeHtml(fmtIdent(u));
          const cals  = getRowNumber(u, ["value","calories","total_calories","totalCalories"]);
          const best  = getRowNumber(u, ["best","best_score","bestScore","score","value"]);
          return `
            <tr>
              <td class="rank">${i+1}</td>
              <td>${ident}</td>
              <td>${fmtInt(cals)}</td>
              <td>${best ? fmtInt(best) : "‚Äî"}</td>
            </tr>
          `;
        }).join("");
      }

      const mapBy = (rows) => {
        const m = new Map();
        (rows || []).forEach(r=>{
          const addr = String(r.address || r.addr || r.id || "").trim() || fmtIdent(r);
          m.set(addr, r);
        });
        return m;
      };

      const ms = mapBy(basketStreak);
      const mc = mapBy(basketScore);

      const merged = [];
      for (const [k, r] of ms.entries()){
        const ident = fmtIdent(r);
        const st = getRowNumber(r, ["value","streak","best_streak","bestStreak"]);
        const rr = mc.get(k);
        const sc = rr ? getRowNumber(rr, ["value","score","best_score","bestScore"]) : 0;
        merged.push({ key:k, ident, st, sc });
      }
      for (const [k, r] of mc.entries()){
        if (ms.has(k)) continue;
        const ident = fmtIdent(r);
        const sc = getRowNumber(r, ["value","score","best_score","bestScore"]);
        merged.push({ key:k, ident, st:0, sc });
      }

      merged.sort((a,b)=> (b.st-a.st) || (b.sc-a.sc));

      if (!merged.length){
        lbBasketBody.innerHTML = `<tr><td colspan="4" class="muted">No streak shot entries yet.</td></tr>`;
      } else {
        lbBasketBody.innerHTML = merged.slice(0,10).map((r,i)=>{
          return `
            <tr>
              <td class="rank">${i+1}</td>
              <td>${escapeHtml(r.ident)}</td>
              <td>${fmtInt(r.st)}</td>
              <td>${fmtInt(r.sc)}</td>
            </tr>
          `;
        }).join("");
      }
    }

    const tabsWrap = document.getElementById("lbTabs");
    tabsWrap.addEventListener("click", (e)=>{
      const btn = e.target.closest(".tab");
      if (!btn) return;
      const win = btn.getAttribute("data-window");
      if (!win) return;

      [...tabsWrap.querySelectorAll(".tab")].forEach(t => t.classList.toggle("active", t === btn));
      activeWindow = win;
      loadAllLeaderboards(activeWindow);
      toast("Showing " + win + " leaders.");
    });

    function logout(){
      clearSession();
      setAuthUI();
      hydrateLocalBestStats();
      toast("Logged out.");
    }

    (async () => {
      setAuthUI();
      hydrateLocalBestStats();
      loadMe();
      loadAllLeaderboards(activeWindow);

      const tgReady = await waitForTelegram(3000);
      if (tgReady){
        wireTelegramWakeups();
        telegramBootstrapRetry();
      }
    })();
  </script>
</body>
</html>